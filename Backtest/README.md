# Backtest

Для корректной работы нужно:

0) Импортировать классы.
1) Переопределить абстрактный метод get_signal класса Strategy в соответствии с описанием внутри.
2) Определить стратегию установки с/л и т/п, переопределив методы get_dinamic_sl и get_dinamic_tp, если это необходимо. Стандартно экземпляры этих классов устанавливают фиксированное значение, расчитывающееся исходя из цены входа в сделку и коэфициента, установленного при создание экземпляра.
3) Создать экземпляры классов SL, TP и Strategy.
4) Создать эжземпляр класса Backtest, сообщив ему экземпляры классов SL, TP, Strategy, предполагаемый размер депозита (стандартно 10000), коэфициент для симуляции спреда (стандартно 0.1), коэффициент для коррекции расчета лота (стандартно 0.1), коэффициент риска, для учета при расчете позиции (стантартно 1% = 0.001) и кредитное плечо (стандартно 1 (отсутствует)).
5) Запустить методв run экземпляра Backtest, передав ему DataFrame с данными, подготовленными для работы с стратегией. По завершению будет возвращен кортеж из итогового значения депозита и списка совершенных сделок с датами, ценами, изменениями значений депозита и причинами закрытия.


Обновления:

 1) Изменен формат возвращяемого значения get_signal класса Strategy c единичного кортежа () на их ансамбль ((),()).
 2) Добавлен расчет размера позиции.
    Пусть:
    Размер счета: $5 000
    Риск для счета: 1%
    Точка аннулирования (диапазон стоп-лосса): 5%
    Для расчета размера позиции используется следующая формула:
    Размер позиции = Размер счета x Риск для счета / Точка аннулирования
    Размер позиции = $5 000 x 0,01 / 0,05
    $1 000 = $5 000 x 0,01 / 0,05
    Размер позиции для этой сделки составит $1 000. Следуя этой стратегии и выходя из сделки в 
    точке аннулирования, вы сможете значительно уменьшить свои потенциальные потери. 
    Чтобы правильно использовать эту модель, вам также необходимо включить в расчет 
    соответствующие комиссии. Кроме того, следует рассчитать возможное проскальзывание, 
    особенно если вы торгуете инструментом с низкой ликвидностью.
    Чтобы продемонстрировать, как это работает, давайте увеличим нашу точку аннулирования до 10%, 
    при этом все остальные числа останутся прежними. 
    Размер позиции = $5 000 x 0,01 / 0,1
    $500 = $5 000 x 0,01 / 0,1
    Наш стоп-лосс теперь в два раза превышает диапазон относительно входа в позицию.
    Итак, если мы готовы рискнуть той же суммой средств на счете, размер нашей позиции сокращается вдвое.
    
    risc_coef=0.01   #риск депозита 1% - безопасный, клсссически используют 2%
    leverage=1/10    #кредитное плечо
    
    real_risk=deposit*risk_coef/abs(sl/price/100)
    pos_volume=lot_coef*(deposit*risk_coef/abs(sl/price/100))*leverage
    
    Рефеференс: https://academy.binance.com/ru/articles/how-to-calculate-position-size-in-trading


To Do:

1) Добавить функции для анализа и визуализации результата тестирования.
2) Добавить более детальноую эмуляцию торговой сессии с расчетами ключевых значений на более младших по отношению к торгуемым таймфреймах, для получения лучшей по качеству статистики.
3) Реализовать механизм margin call для возможности корректного использования кредитного плеча при тестировании.
